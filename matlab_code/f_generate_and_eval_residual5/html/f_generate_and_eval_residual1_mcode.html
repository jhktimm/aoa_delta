<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">s_max</span>, <span class="var type1" id="S3T2U4">classis</span>, <span class="var type1" id="S4T2U5">strengthis</span>, <span class="var type1" id="S5T2U6">strengtVar</span>, <span class="var type1" id="S6T2U7">maxis</span>, <span class="var type1" id="S7T2U8">minis</span>, <span class="var type1" id="S8T2U9">QL</span>, <span class="var type1" id="S9T2U10">dw_stat</span>, <span class="var type1" id="S10T2U11">SP_F</span>, <span class="var type1" id="S11T2U12">SP_P</span>, <span class="var type1" id="S12T3U13">PC</span>, <span class="var type1" id="S13T2U14">calib_check</span>] = f_generate_and_eval_residual( <span class="var type1" id="S14T1U17">PA</span>, <span class="var type1" id="S15T1U18">PP</span>, <span class="var type1" id="S16T1U19">FA</span>, <span class="var type1" id="S17T1U20">FP</span>, <span class="var type1" id="S18T1U21">RA</span>, <span class="var type1" id="S19T1U22">RP</span>, <span class="var type1" id="S20T2U23">FS</span>, <span class="var type1" id="S21T2U24">F0</span>, <span class="var type1" id="S22T4U25">cal_coeff</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line">    , <span class="var type1" id="S23T5U26">tau_m</span>, <span class="var type1" id="S24T5U27">K_m</span>, <span class="var type1" id="S25T5U28">X0</span>, <span class="var type1" id="S26T2U29">QL_nom</span>, <span class="var type1" id="S27T2U30">DELAY</span>, <span class="var type1" id="S28T2U31">FILLING</span>, <span class="var type1" id="S29T2U32">FLATTOP</span>, <span class="var type1" id="S30T6U33">Sigma_nom</span>, <span class="var type1" id="S31T7U34">r_mean_nom</span>, <span class="var type1" id="S32T6U35">MeasNoiseVar</span>, <span class="var type1" id="S33T8U36">ProcessVar</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% This function evaluates the residual</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo " id="T3:U33"><span class="mxinfo " id="T2:U34">sum(<span class="mxinfo " id="T9:U35"><span class="mxinfo " id="T1:U36"><span class="var type1" id="S15T1U43">PP</span>(<span class="mxinfo " id="T10:U38"><span class="mxinfo " id="T2:U39">40</span>:end</span>)</span> == <span class="mxinfo " id="T2:U40">0</span></span>)</span> &gt; <span class="mxinfo " id="T2:U41">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T1:U42"><span class="var type1" id="S36T1U52">idx</span> = <span class="mxinfo " id="T1:U44">find(<span class="mxinfo " id="T9:U45"><span class="mxinfo " id="T1:U46"><span class="var type1" id="S15T1U57">PP</span>(<span class="mxinfo " id="T10:U48"><span class="mxinfo " id="T2:U49">40</span>:end</span>)</span> == <span class="mxinfo " id="T2:U50">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo " id="T1:U51"><span class="mxinfo " id="T1:U52"><span class="var type1" id="S15T1U66">PP</span>(<span class="mxinfo " id="T1:U54"><span class="mxinfo " id="T1:U55"><span class="mxinfo " id="T2:U56">40</span>+<span class="var type1" id="S36T1U70">idx</span></span>-<span class="mxinfo " id="T2:U58">1</span></span>)</span> = <span class="mxinfo " id="T1:U59"><span class="var type1" id="S15T1U73">PP</span>(<span class="mxinfo " id="T1:U61"><span class="mxinfo " id="T1:U62"><span class="mxinfo " id="T2:U63">40</span>+<span class="var type1" id="S36T1U77">idx</span></span>-<span class="mxinfo " id="T2:U65">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U66"><span class="mxinfo " id="T2:U67">max(<span class="var type1" id="S14T1U84">PA</span>)</span>&lt;<span class="mxinfo " id="T2:U69">10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T11:U70"><span class="var type1" id="S39T11U88">res_full_mean</span> = <span class="mxinfo " id="T2:U72">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    [<span class="var type1" id="S39T11U95">res_full_mean</span>, <span class="var type1" id="S41T12U96">res_full_variance</span>]<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        = f_generate_online_UKF_residual_full(<span class="var type1" id="S14T1U99">PA</span>,<span class="var type1" id="S15T1U100">PP</span>, <span class="var type1" id="S16T1U101">FA</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="var type1" id="S17T1U102">FP</span>, <span class="var type1" id="S18T1U103">RA</span>, <span class="var type1" id="S19T1U104">RP</span>, <span class="var type1" id="S20T2U105">FS</span>, <span class="var type1" id="S21T2U106">F0</span>, <span class="var type1" id="S22T4U107">cal_coeff</span>, <span class="var type1" id="S23T5U108">tau_m</span>, <span class="var type1" id="S24T5U109">K_m</span>, <span class="var type1" id="S25T5U110">X0</span>, <span class="var type1" id="S26T2U111">QL_nom</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="var type1" id="S27T2U112">DELAY</span>, <span class="var type1" id="S28T2U113">FILLING</span>, <span class="var type1" id="S29T2U114">FLATTOP</span> ,<span class="var type1" id="S32T6U115">MeasNoiseVar</span>,<span class="var type1" id="S33T8U116">ProcessVar</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">% r_cmplx = res_full_mean(1,:).'+1i*res_full_mean(2,:).';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T13:U93"><span class="var type1" id="S43T13U119">y</span> = <span class="mxinfo " id="T13:U95">zeros(<span class="mxinfo " id="T2:U96">2</span>, <span class="mxinfo " id="T2:U97">length(<span class="var type1" id="S39T11U125">res_full_mean</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S46T2U128">ii</span> = <span class="mxinfo " id="T2:U100">1</span>:<span class="mxinfo " id="T2:U101">length(<span class="var type1" id="S39T11U133">res_full_mean</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T7:U103"><span class="mxinfo " id="T7:U104"><span class="var type1" id="S43T13U137">y</span>(<span class="mxinfo " id="T14:U106">:</span>,<span class="var type1" id="S46T2U139">ii</span>)</span> = <span class="mxinfo " id="T7:U108"><span class="mxinfo " id="T15:U109"><span class="var type1" id="S39T11U142">res_full_mean</span>(<span class="mxinfo " id="T16:U111">:</span>,<span class="var type1" id="S46T2U144">ii</span>)</span> - <span class="var type1" id="S31T7U145">r_mean_nom</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T2:U114"><span class="var type1" id="S47T2U148">N</span>=<span class="mxinfo " id="T2:U116">10</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T1:U117">[<span class="var type1" id="S2T1U153">s_max</span>] = <span class="mxinfo " id="T1:U119"><span class="mxinfo " id="T10:U120"><span class="fcn" id="F1287N7:B156">f_GLT</span>(<span class="var type1" id="S30T6U157">Sigma_nom</span>, <span class="var type1" id="S43T13U158">y</span>, <span class="var type1" id="S47T2U159">N</span>)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="comment">%% Check if GLT is above a threshold.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T2:U124"><span class="var type1" id="S3T2U162">classis</span> = <span class="mxinfo " id="T2:U126">sum(<span class="mxinfo " id="T9:U127"><span class="mxinfo " id="T1:U128"><span class="var type1" id="S2T1U167">s_max</span>(<span class="mxinfo " id="T10:U130"><span class="mxinfo " id="T2:U131">40</span>:end</span>)</span> &gt; <span class="mxinfo " id="T2:U132">13.8</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T2:U133"><span class="var type1" id="S4T2U175">strengthis</span> = <span class="mxinfo " id="T2:U135">mean(<span class="mxinfo " id="T1:U136"><span class="var type1" id="S2T1U179">s_max</span>(<span class="mxinfo " id="T10:U138"><span class="mxinfo " id="T2:U139">40</span>:end</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T2:U140"><span class="var type1" id="S5T2U186">strengtVar</span> = <span class="mxinfo " id="T2:U142">var(<span class="mxinfo " id="T1:U143"><span class="var type1" id="S2T1U190">s_max</span>(<span class="mxinfo " id="T10:U145"><span class="mxinfo " id="T2:U146">40</span>:end</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T2:U147"><span class="var type1" id="S6T2U197">maxis</span> = <span class="mxinfo " id="T2:U149">max(<span class="mxinfo " id="T1:U150"><span class="var type1" id="S2T1U201">s_max</span>(<span class="mxinfo " id="T10:U152"><span class="mxinfo " id="T2:U153">40</span>:end</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T2:U154"><span class="var type1" id="S7T2U208">minis</span> = <span class="mxinfo " id="T2:U156">min(<span class="mxinfo " id="T1:U157"><span class="var type1" id="S2T1U212">s_max</span>(<span class="mxinfo " id="T10:U159"><span class="mxinfo " id="T2:U160">40</span>:end</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="comment">%% Get QL value and static detuning value</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T2:U161"><span class="var type1" id="S52T2U219">fs</span> = <span class="mxinfo " id="T2:U163"><span class="var type1" id="S20T2U221">FS</span>*<span class="mxinfo " id="T2:U165">1e6</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T2:U166"><span class="var type1" id="S53T2U225">f0</span> = <span class="mxinfo " id="T2:U168"><span class="var type1" id="S21T2U227">F0</span>*<span class="mxinfo " id="T2:U170">1e6</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U171"><span class="var type1" id="S52T2U232">fs</span> ==<span class="mxinfo " id="T2:U173">1e6</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T10:U174"><span class="var type1" id="S54T10U236">Rise</span> = <span class="mxinfo " id="T10:U176"><span class="mxinfo " id="T2:U177">round(<span class="mxinfo " id="T2:U178"><span class="mxinfo " id="T2:U179"><span class="var type1" id="S27T2U242">DELAY</span> * <span class="var type1" id="S52T2U243">fs</span></span> *<span class="mxinfo " id="T2:U182">1e-6</span></span>)</span>:<span class="mxinfo " id="T2:U183">round(<span class="mxinfo " id="T2:U184"><span class="mxinfo " id="T2:U185"><span class="mxinfo " id="T2:U186"><span class="var type1" id="S27T2U250">DELAY</span> * <span class="var type1" id="S52T2U251">fs</span></span>*<span class="mxinfo " id="T2:U189">1e-6</span></span>+ <span class="mxinfo " id="T2:U190"><span class="mxinfo " id="T2:U191"><span class="var type1" id="S28T2U255">FILLING</span>*<span class="var type1" id="S52T2U256">fs</span></span>*<span class="mxinfo " id="T2:U194">1e-6</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T10:U195"><span class="var type1" id="S56T10U260">Flattop</span> = <span class="mxinfo " id="T10:U197"><span class="mxinfo " id="T2:U198"><span class="mxinfo " id="T2:U199"><span class="var type1" id="S54T10U264">Rise</span>(<span class="mxinfo " id="T2:U201">end</span>)</span>+<span class="mxinfo " id="T2:U202">1</span></span> : <span class="mxinfo " id="T2:U203"><span class="mxinfo " id="T2:U204"><span class="mxinfo " id="T2:U205"><span class="var type1" id="S54T10U271">Rise</span>(<span class="mxinfo " id="T2:U207">end</span>)</span>+<span class="mxinfo " id="T2:U208">1</span></span>+<span class="mxinfo " id="T2:U209">round(<span class="mxinfo " id="T2:U210"><span class="mxinfo " id="T2:U211"><span class="var type1" id="S29T2U279">FLATTOP</span>*<span class="var type1" id="S52T2U280">fs</span></span>*<span class="mxinfo " id="T2:U214">1e-6</span></span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T10:U215"><span class="var type1" id="S57T10U284">Decay</span> = <span class="mxinfo " id="T10:U217"><span class="mxinfo " id="T2:U218"><span class="mxinfo " id="T2:U219"><span class="var type1" id="S56T10U288">Flattop</span>(<span class="mxinfo " id="T2:U221">end</span>)</span>+<span class="mxinfo " id="T2:U222">1</span></span> : round(2^(14)/9+1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T10:U223"><span class="var type1" id="S54T10U305">Rise</span> = <span class="mxinfo " id="T10:U225"><span class="mxinfo " id="T2:U226">round(<span class="mxinfo " id="T2:U227"><span class="mxinfo " id="T2:U228"><span class="var type1" id="S27T2U311">DELAY</span> * <span class="var type1" id="S52T2U312">fs</span></span> *<span class="mxinfo " id="T2:U231">1e-6</span></span>)</span>:<span class="mxinfo " id="T2:U232">round(<span class="mxinfo " id="T2:U233"><span class="mxinfo " id="T2:U234"><span class="mxinfo " id="T2:U235"><span class="var type1" id="S27T2U319">DELAY</span> * <span class="var type1" id="S52T2U320">fs</span></span>*<span class="mxinfo " id="T2:U238">1e-6</span></span>+ <span class="mxinfo " id="T2:U239"><span class="mxinfo " id="T2:U240"><span class="var type1" id="S28T2U324">FILLING</span>*<span class="var type1" id="S52T2U325">fs</span></span>*<span class="mxinfo " id="T2:U243">1e-6</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T10:U244"><span class="var type1" id="S56T10U329">Flattop</span> = <span class="mxinfo " id="T10:U246"><span class="mxinfo " id="T2:U247"><span class="mxinfo " id="T2:U248"><span class="var type1" id="S54T10U333">Rise</span>(<span class="mxinfo " id="T2:U250">end</span>)</span>+<span class="mxinfo " id="T2:U251">1</span></span> : <span class="mxinfo " id="T2:U252"><span class="mxinfo " id="T2:U253"><span class="mxinfo " id="T2:U254"><span class="var type1" id="S54T10U340">Rise</span>(<span class="mxinfo " id="T2:U256">end</span>)</span>+<span class="mxinfo " id="T2:U257">1</span></span>+<span class="mxinfo " id="T2:U258">round(<span class="mxinfo " id="T2:U259"><span class="mxinfo " id="T2:U260"><span class="var type1" id="S29T2U348">FLATTOP</span>*<span class="var type1" id="S52T2U349">fs</span></span>*<span class="mxinfo " id="T2:U263">1e-6</span></span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo " id="T10:U264"><span class="var type1" id="S57T10U353">Decay</span> = <span class="mxinfo " id="T10:U266"><span class="mxinfo " id="T2:U267"><span class="mxinfo " id="T2:U268"><span class="var type1" id="S56T10U357">Flattop</span>(<span class="mxinfo " id="T2:U270">end</span>)</span>+<span class="mxinfo " id="T2:U271">1</span></span> : 2^(14)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T17:U272"><span class="var type1" id="S58T17U367">y_mC</span> = complex(<span class="mxinfo " id="T17:U274"><span class="var type1" id="S14T1U371">PA</span>.*<span class="mxinfo " id="T17:U276">exp(<span class="mxinfo " id="T17:U277"><span class="mxinfo " id="T17:U278"><span class="mxinfo " id="T17:U279"><span class="mxinfo " id="T18:U280">1i</span>*<span class="var type1" id="S15T1U378">PP</span></span>/180</span>*<span class="mxinfo " id="T2:U282">pi</span></span>)</span></span>)</span>; <span class="comment">% Complex Probe measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo " id="T17:U283"><span class="var type1" id="S62T17U384">u_mC</span> = complex(<span class="mxinfo " id="T17:U285"><span class="var type1" id="S16T1U388">FA</span>.*<span class="mxinfo " id="T17:U287">exp(<span class="mxinfo " id="T17:U288"><span class="mxinfo " id="T17:U289"><span class="mxinfo " id="T17:U290"><span class="mxinfo " id="T18:U291">1i</span>*<span class="var type1" id="S17T1U395">FP</span></span>/180</span>*<span class="mxinfo " id="T2:U293">pi</span></span>)</span></span>)</span>; <span class="comment">% Complex Forward measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo " id="T17:U294"><span class="var type1" id="S63T17U401">r_mC</span> = complex(<span class="mxinfo " id="T17:U296"><span class="var type1" id="S18T1U405">RA</span>.*<span class="mxinfo " id="T17:U298">exp(<span class="mxinfo " id="T17:U299"><span class="mxinfo " id="T17:U300"><span class="mxinfo " id="T17:U301"><span class="mxinfo " id="T18:U302">1i</span>*<span class="var type1" id="S19T1U412">RP</span></span>/180</span>*<span class="mxinfo " id="T2:U304">pi</span></span>)</span></span>)</span>; <span class="comment">% Reflected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">[<span class="var type1" id="S64T17U419">u_mCal</span>, <span class="var type1" id="S65T17U420">r_mCal</span>] = <span class="fcn" id="F174N8:B422">f_calibrateData</span>(<span class="var type1" id="S62T17U423">u_mC</span>, <span class="var type1" id="S63T17U424">r_mC</span>, <span class="var type1" id="S58T17U425">y_mC</span>, <span class="var type1" id="S22T4U426">cal_coeff</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U311"><span class="mxinfo " id="T2:U312">mean(<span class="mxinfo " id="T1:U313">abs(<span class="mxinfo " id="T17:U314"><span class="mxinfo " id="T17:U315"><span class="var type1" id="S58T17U437">y_mC</span>(<span class="var type1" id="S56T10U438">Flattop</span>)</span> - (<span class="mxinfo " id="T17:U318"><span class="mxinfo " id="T17:U319"><span class="var type1" id="S64T17U442">u_mCal</span>(<span class="var type1" id="S56T10U443">Flattop</span>)</span> + <span class="mxinfo " id="T17:U322"><span class="var type1" id="S65T17U445">r_mCal</span>(<span class="var type1" id="S56T10U446">Flattop</span>)</span></span>)</span>)</span>)</span> &lt; <span class="mxinfo " id="T2:U325">0.05</span></span> &amp;&amp; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">        <span class="mxinfo " id="T3:U326"><span class="mxinfo " id="T2:U327">mean(<span class="mxinfo " id="T1:U328">abs(<span class="mxinfo " id="T17:U329"><span class="var type1" id="S64T17U454">u_mCal</span>(<span class="mxinfo " id="T10:U331"><span class="var type1" id="S57T10U456">Decay</span>(<span class="mxinfo " id="T10:U333"><span class="mxinfo " id="T2:U334">25</span>:<span class="mxinfo " id="T2:U335"><span class="mxinfo " id="T2:U336">end</span>-<span class="mxinfo " id="T2:U337">1</span></span></span>)</span>)</span>)</span>)</span> &lt; <span class="mxinfo " id="T2:U338">0.8</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">    <span class="mxinfo " id="T2:U339"><span class="var type1" id="S13T2U466">calib_check</span>  = <span class="mxinfo " id="T2:U341">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo " id="T2:U342"><span class="var type1" id="S13T2U471">calib_check</span> = <span class="mxinfo " id="T2:U344">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="mxinfo " id="T2:U345"><span class="var type1" id="S8T2U475">QL</span>  = <span class="mxinfo " id="T2:U347">mean(<span class="mxinfo " id="T2:U348"><span class="fcn" id="F1328N10:B479">f_computeQL</span>(<span class="var type1" id="S57T10U480">Decay</span>, <span class="var type1" id="S58T17U481">y_mC</span>, <span class="var type1" id="S52T2U482">fs</span>, <span class="var type1" id="S53T2U483">f0</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="mxinfo " id="T1:U353"><span class="var type1" id="S69T1U486">dw</span> = <span class="mxinfo " id="T1:U355"><span class="fcn" id="F1408N11:B488">f_compute_detuning</span>(<span class="var type1" id="S58T17U489">y_mC</span>, <span class="var type1" id="S64T17U490">u_mCal</span>, <span class="var type1" id="S52T2U491">fs</span>, <span class="var type1" id="S8T2U492">QL</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line"><span class="mxinfo " id="T2:U360"><span class="var type1" id="S9T2U495">dw_stat</span> = <span class="mxinfo " id="T2:U362">mean(<span class="mxinfo " id="T1:U363"><span class="var type1" id="S69T1U499">dw</span>(<span class="var type1" id="S56T10U500">Flattop</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line"><span class="mxinfo " id="T2:U366"><span class="var type1" id="S11T2U503">SP_P</span> = <span class="mxinfo " id="T2:U368">mean(<span class="mxinfo " id="T1:U369"><span class="var type1" id="S14T1U507">PA</span>(<span class="var type1" id="S56T10U508">Flattop</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"><span class="mxinfo " id="T2:U372"><span class="var type1" id="S10T2U511">SP_F</span> = <span class="mxinfo " id="T2:U374">mean(<span class="mxinfo " id="T1:U375">abs(<span class="mxinfo " id="T17:U376"><span class="var type1" id="S64T17U517">u_mCal</span>(<span class="var type1" id="S54T10U518">Rise</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line"><span class="mxinfo " id="T3:U379"><span class="var type1" id="S12T3U521">PC</span> = <span class="mxinfo " id="T3:U381"><span class="mxinfo " id="T2:U382">abs(<span class="mxinfo " id="T18:U383"><span class="var type1" id="S64T17U526">u_mCal</span>(<span class="mxinfo " id="T2:U385"><span class="var type1" id="S56T10U528">Flattop</span>(<span class="mxinfo " id="T2:U387"><span class="mxinfo " id="T2:U388">end</span>-<span class="mxinfo " id="T2:U389">1</span></span>)</span>)</span>)</span> &lt; <span class="mxinfo " id="T2:U390">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line"><span class="comment">% figure(21)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line"><span class="comment">% hold on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line"><span class="comment">% plot(res_full_mean(1,:),'k')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line"><span class="comment">% plot(res_full_mean(2,:),'k')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line"><span class="comment">% xlabel('Samples')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line"><span class="comment">% ylabel('Residual')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line"><span class="comment">% ylim([-0.05,0.05])</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line"><span class="comment">%[FIT, y_mC_hat]=f_cavitySystemSimulatior(y_mC, u_mC, f0, fs, sys_hat, QL, plt, u3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77">77</a></span><span class="line"></span></span>
</pre>
</body>
</html>
