<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">r_cmplx</span>, <span class="var type1" id="S3T2U4">s_max</span> ] = f_generate_and_eval_residual( <span class="var type1" id="S4T2U7">PA</span>, <span class="var type1" id="S5T2U8">PP</span>, <span class="var type1" id="S6T2U9">FA</span>, <span class="var type1" id="S7T2U10">FP</span>, <span class="var type1" id="S8T2U11">RA</span>, <span class="var type1" id="S9T2U12">RP</span>, <span class="var type1" id="S10T3U13">FS</span>, <span class="var type1" id="S11T3U14">F0</span>, <span class="var type1" id="S12T4U15">cal_coeff</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line">    , <span class="var type1" id="S13T5U16">tau_m</span>, <span class="var type1" id="S14T5U17">K_m</span>, <span class="var type1" id="S15T5U18">X0</span>, <span class="var type1" id="S16T3U19">QL_nom</span>, <span class="var type1" id="S17T3U20">DELAY</span>, <span class="var type1" id="S18T3U21">FILLING</span>, <span class="var type1" id="S19T3U22">FLATTOP</span>, <span class="var type1" id="S20T6U23">Sigma_nom</span>, <span class="var type1" id="S21T7U24">r_mean_nom</span>, <span class="var type1" id="S22T6U25">MeasNoiseVar</span>,<span class="var type1" id="S23T8U26">ProcessVar</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% This function evaluates the residual</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T9:U23"><span class="mxinfo " id="T3:U24">max(<span class="var type1" id="S4T2U32">PA</span>)</span>&lt;<span class="mxinfo " id="T3:U26">10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T10:U27"><span class="var type1" id="S25T10U36">res_full_mean</span> = <span class="mxinfo " id="T3:U29">NaN</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">[<span class="var type1" id="S25T10U43">res_full_mean</span>, <span class="var type1" id="S27T11U44">res_full_variance</span>]<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    = f_generate_online_UKF_residual_full(<span class="var type1" id="S4T2U47">PA</span>,<span class="var type1" id="S5T2U48">PP</span>, <span class="var type1" id="S6T2U49">FA</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="var type1" id="S7T2U50">FP</span>, <span class="var type1" id="S8T2U51">RA</span>, <span class="var type1" id="S9T2U52">RP</span>, <span class="var type1" id="S10T3U53">FS</span>, <span class="var type1" id="S11T3U54">F0</span>, <span class="var type1" id="S12T4U55">cal_coeff</span>, <span class="var type1" id="S13T5U56">tau_m</span>, <span class="var type1" id="S14T5U57">K_m</span>, <span class="var type1" id="S15T5U58">X0</span>, <span class="var type1" id="S16T3U59">QL_nom</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="var type1" id="S17T3U60">DELAY</span>, <span class="var type1" id="S18T3U61">FILLING</span>, <span class="var type1" id="S19T3U62">FLATTOP</span> ,<span class="var type1" id="S22T6U63">MeasNoiseVar</span>,<span class="var type1" id="S23T8U64">ProcessVar</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T1:U50"><span class="var type1" id="S2T1U67">r_cmplx</span> = <span class="mxinfo " id="T1:U52"><span class="mxinfo " id="T2:U53"><span class="mxinfo " id="T12:U54"><span class="var type1" id="S25T10U71">res_full_mean</span>(<span class="mxinfo " id="T3:U56">1</span>,<span class="mxinfo " id="T13:U57">:</span>)</span>.'</span>+<span class="mxinfo " id="T1:U58"><span class="mxinfo " id="T14:U59">1i</span>*<span class="mxinfo " id="T2:U60"><span class="mxinfo " id="T12:U61"><span class="var type1" id="S25T10U78">res_full_mean</span>(<span class="mxinfo " id="T3:U63">2</span>,<span class="mxinfo " id="T13:U64">:</span>)</span>.'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T15:U65"><span class="var type1" id="S29T15U83">y</span> = <span class="mxinfo " id="T15:U67">zeros(<span class="mxinfo " id="T3:U68">2</span>, <span class="mxinfo " id="T3:U69">length(<span class="var type1" id="S25T10U89">res_full_mean</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S32T3U92">ii</span> = <span class="mxinfo " id="T3:U72">1</span>:<span class="mxinfo " id="T3:U73">length(<span class="var type1" id="S25T10U97">res_full_mean</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T7:U75"><span class="mxinfo " id="T7:U76"><span class="var type1" id="S29T15U101">y</span>(<span class="mxinfo " id="T16:U78">:</span>,<span class="var type1" id="S32T3U103">ii</span>)</span> = <span class="mxinfo " id="T7:U80"><span class="mxinfo " id="T17:U81"><span class="var type1" id="S25T10U106">res_full_mean</span>(<span class="mxinfo " id="T18:U83">:</span>,<span class="var type1" id="S32T3U108">ii</span>)</span> - <span class="var type1" id="S21T7U109">r_mean_nom</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T3:U86"><span class="var type1" id="S33T3U112">N</span>=<span class="mxinfo " id="T3:U88">10</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T2:U89">[<span class="var type1" id="S3T2U117">s_max</span>] = <span class="mxinfo " id="T2:U91"><span class="mxinfo " id="T12:U92"><span class="fcn" id="F1220N10:B120">f_GLT</span>(<span class="var type1" id="S20T6U121">Sigma_nom</span>, <span class="var type1" id="S29T15U122">y</span>, <span class="var type1" id="S33T3U123">N</span>)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">function [s_max] = f_GLT(Sigma, y, N)</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="comment">% The Generalized likelihood test adapted from S.Ding Model Based Fault Detection,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="comment">% Algorithm 10.4 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">s_max = zeros(1,length(y));</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">for ii = 1:length(y)-N-1</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    y_bar = 1/N * sum(y(:,ii:ii+N),2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">   s_max(ii) = N/2* y_bar.' * ((Sigma)\eye(2)) * y_bar;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">   s_max(ii);</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
