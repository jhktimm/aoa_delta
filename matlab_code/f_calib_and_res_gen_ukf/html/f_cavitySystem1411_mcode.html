<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="195,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T95U3">dx</span>]=f_cavitySystem(<span class="var type1" id="S3T95U6">x</span>, <span class="var type1" id="S4T55U7">u_mC</span>, <span class="var type1" id="S5T5U8">f0</span>, <span class="var type1" id="S6T5U9">fs</span>, <span class="var type1" id="S7T6U10">tau_m</span>, <span class="var type1" id="S8T6U11">K_m</span>, <span class="var type1" id="S9T5U12">QL</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="195,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="195,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%% Coupled simulink model</span></span></span>
<span class="srcline"><span class="lineno"><a href="195,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T5:U9"><span class="var type1" id="S10T5U15">Ts</span> = <span class="mxinfo " id="T5:U11"><span class="mxinfo " id="T5:U12">1</span>/<span class="var type1" id="S6T5U18">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T5:U14"><span class="var type1" id="S11T5U21">w12</span> = <span class="mxinfo " id="T5:U16"><span class="mxinfo " id="T5:U17"><span class="mxinfo " id="T5:U18">pi</span>*<span class="var type1" id="S5T5U26">f0</span></span>./<span class="var type1" id="S9T5U27">QL</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%---------- Define System from identified greybox model------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="195,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T202:U21"><span class="var type1" id="S13T202U30">A</span> = <span class="mxinfo " id="T202:U23">diag(<span class="mxinfo " id="T6:U24">-1./<span class="var type1" id="S7T6U36">tau_m</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T6:U26"><span class="var type1" id="S15T6U39">B</span> = <span class="mxinfo " id="T6:U28"><span class="mxinfo " id="T6:U29"><span class="mxinfo " id="T5:U30">-2*pi</span>*<span class="var type1" id="S8T6U47">K_m</span></span>./<span class="var type1" id="S7T6U48">tau_m</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% ------------- Discrete State Space System -----------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="195,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T95:U33"><span class="var type1" id="S2T95U51">dx</span> = <span class="mxinfo " id="T95:U35">zeros(<span class="mxinfo " id="T5:U36">2+length(<span class="var type1" id="S15T6U58">B</span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,11" id="srcline11">11</a></span><span class="line"><span class="comment">% ---------- Values---------</span></span></span>
<span class="srcline"><span class="lineno"><a href="195,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T5:U38"><span class="var type1" id="S18T5U62">a0</span> = <span class="mxinfo " id="T5:U40"><span class="mxinfo " id="T5:U41">-<span class="mxinfo " id="T5:U42">1</span></span>+ <span class="mxinfo " id="T5:U43"><span class="var type1" id="S11T5U67">w12</span>*<span class="var type1" id="S10T5U68">Ts</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T5:U46"><span class="var type1" id="S19T5U71">b0</span> = <span class="mxinfo " id="T5:U48"><span class="mxinfo " id="T5:U49"><span class="mxinfo " id="T5:U50">2</span>*<span class="var type1" id="S11T5U75">w12</span></span>*<span class="var type1" id="S10T5U76">Ts</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T5:U53">[<span class="var type1" id="S20T5U80">n</span>,<span class="mxinfo " id="T5:U55">~</span>] = size(<span class="var type1" id="S13T202U84">A</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T202:U57"><span class="var type1" id="S22T202U87">A_d</span> = <span class="mxinfo " id="T202:U59">(<span class="mxinfo " id="T202:U60"><span class="mxinfo " id="T202:U61">eye(<span class="var type1" id="S20T5U93">n</span>,<span class="var type1" id="S20T5U94">n</span>)</span>+<span class="mxinfo " id="T202:U64"><span class="mxinfo " id="T202:U65"><span class="mxinfo " id="T5:U66">0.5</span>*<span class="var type1" id="S13T202U98">A</span></span>*<span class="var type1" id="S10T5U99">Ts</span></span></span>)*<span class="mxinfo " id="T202:U69">inv(<span class="mxinfo " id="T202:U70"><span class="mxinfo " id="T202:U71">eye(<span class="var type1" id="S20T5U105">n</span>,<span class="var type1" id="S20T5U106">n</span>)</span>-<span class="mxinfo " id="T202:U74"><span class="mxinfo " id="T202:U75"><span class="mxinfo " id="T5:U76">0.5</span>*<span class="var type1" id="S13T202U110">A</span></span>*<span class="var type1" id="S10T5U111">Ts</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T6:U79"><span class="var type1" id="S25T6U114">B_d</span> = <span class="mxinfo " id="T6:U81"><span class="var type1" id="S10T5U116">Ts</span>*<span class="var type1" id="S15T6U117">B</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T5:U84"><span class="var type1" id="S26T5U120">u1</span> = <span class="mxinfo " id="T5:U86"><span class="var type1" id="S4T55U122">u_mC</span>(<span class="mxinfo " id="T5:U88">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T5:U89"><span class="var type1" id="S27T5U126">u2</span> = <span class="mxinfo " id="T5:U91"><span class="var type1" id="S4T55U128">u_mC</span>(<span class="mxinfo " id="T5:U93">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T5:U94"><span class="mxinfo " id="T5:U95"><span class="var type1" id="S2T95U133">dx</span>(<span class="mxinfo " id="T5:U97">1</span>)</span> = <span class="mxinfo " id="T5:U98"><span class="mxinfo " id="T5:U99"><span class="mxinfo " id="T5:U100"><span class="mxinfo " id="T5:U101">-<span class="var type1" id="S18T5U139">a0</span></span>*<span class="mxinfo " id="T5:U103"><span class="var type1" id="S3T95U141">x</span>(<span class="mxinfo " id="T5:U105">1</span>)</span></span>-<span class="mxinfo " id="T5:U106"><span class="mxinfo " id="T5:U107"><span class="mxinfo " id="T5:U108">sum(<span class="mxinfo " id="T6:U109"><span class="var type1" id="S3T95U148">x</span>(<span class="mxinfo " id="T66:U111">3:3+<span class="var type1" id="S20T5U154">n</span>-1</span>)</span>)</span>*<span class="mxinfo " id="T5:U113"><span class="var type1" id="S3T95U157">x</span>(<span class="mxinfo " id="T5:U115">2</span>)</span></span>*<span class="var type1" id="S10T5U159">Ts</span></span></span> + <span class="mxinfo " id="T5:U117"><span class="var type1" id="S19T5U161">b0</span> * <span class="var type1" id="S26T5U162">u1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T5:U120"><span class="mxinfo " id="T5:U121"><span class="var type1" id="S2T95U166">dx</span>(<span class="mxinfo " id="T5:U123">2</span>)</span> = <span class="mxinfo " id="T5:U124"><span class="mxinfo " id="T5:U125"><span class="mxinfo " id="T5:U126"><span class="mxinfo " id="T5:U127"><span class="mxinfo " id="T5:U128">sum(<span class="mxinfo " id="T6:U129"><span class="var type1" id="S3T95U175">x</span>(<span class="mxinfo " id="T66:U131">3:3+<span class="var type1" id="S20T5U181">n</span>-1</span>)</span>)</span> * <span class="mxinfo " id="T5:U133"><span class="var type1" id="S3T95U184">x</span>(<span class="mxinfo " id="T5:U135">1</span>)</span></span> * <span class="var type1" id="S10T5U186">Ts</span></span> - <span class="mxinfo " id="T5:U137"><span class="var type1" id="S18T5U188">a0</span>*<span class="mxinfo " id="T5:U139"><span class="var type1" id="S3T95U190">x</span>(<span class="mxinfo " id="T5:U141">2</span>)</span></span></span> +<span class="mxinfo " id="T5:U142"><span class="var type1" id="S19T5U193">b0</span>* <span class="var type1" id="S27T5U194">u2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T70:U145"><span class="mxinfo " id="T70:U146"><span class="var type1" id="S2T95U198">dx</span>(<span class="mxinfo " id="T70:U148"><span class="mxinfo " id="T5:U149">3</span>:<span class="mxinfo " id="T5:U150">3+<span class="var type1" id="S20T5U204">n</span>-1</span></span>)</span> = <span class="mxinfo " id="T6:U152"><span class="mxinfo " id="T6:U153"><span class="var type1" id="S22T202U208">A_d</span> * <span class="mxinfo " id="T6:U155"><span class="var type1" id="S3T95U210">x</span>(<span class="mxinfo " id="T66:U157">3:3+<span class="var type1" id="S20T5U216">n</span>-1</span>)</span></span> + <span class="mxinfo " id="T6:U159"><span class="var type1" id="S25T6U219">B_d</span> * (<span class="mxinfo " id="T5:U161"><span class="mxinfo " id="T5:U162"><span class="mxinfo " id="T5:U163"><span class="var type1" id="S3T95U224">x</span>(<span class="mxinfo " id="T18:U165">1</span>)</span>.^2</span>+<span class="mxinfo " id="T5:U166"><span class="mxinfo " id="T5:U167"><span class="var type1" id="S3T95U229">x</span>(<span class="mxinfo " id="T18:U169">2</span>)</span>.^2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="195,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="195,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
