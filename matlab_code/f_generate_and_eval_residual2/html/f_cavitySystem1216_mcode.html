<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="188,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T67U3">dx</span>]=f_cavitySystem(<span class="var type1" id="S3T67U6">x</span>, <span class="var type1" id="S4T6U7">u_mC</span>, <span class="var type1" id="S5T2U8">f0</span>, <span class="var type1" id="S6T2U9">fs</span>, <span class="var type1" id="S7T4U10">tau_m</span>, <span class="var type1" id="S8T4U11">K_m</span>, <span class="var type1" id="S9T2U12">QL</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="188,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="188,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%% Coupled simulink model</span></span></span>
<span class="srcline"><span class="lineno"><a href="188,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T2:U9"><span class="var type1" id="S10T2U15">Ts</span> = <span class="mxinfo " id="T2:U11"><span class="mxinfo " id="T2:U12">1</span>/<span class="var type1" id="S6T2U18">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U14"><span class="var type1" id="S11T2U21">w12</span> = <span class="mxinfo " id="T2:U16"><span class="mxinfo " id="T2:U17"><span class="mxinfo " id="T2:U18">pi</span>*<span class="var type1" id="S5T2U26">f0</span></span>./<span class="var type1" id="S9T2U27">QL</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%---------- Define System from identified greybox model------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="188,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T187:U21"><span class="var type1" id="S13T187U30">A</span> = <span class="mxinfo " id="T187:U23">diag(<span class="mxinfo " id="T4:U24">-1./<span class="var type1" id="S7T4U36">tau_m</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T4:U26"><span class="var type1" id="S15T4U39">B</span> = <span class="mxinfo " id="T4:U28"><span class="mxinfo " id="T4:U29"><span class="mxinfo " id="T2:U30">-2*pi</span>*<span class="var type1" id="S8T4U47">K_m</span></span>./<span class="var type1" id="S7T4U48">tau_m</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% ------------- Discrete State Space System -----------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="188,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T67:U33"><span class="var type1" id="S2T67U51">dx</span> = <span class="mxinfo " id="T67:U35">zeros(<span class="mxinfo " id="T2:U36">2+length(<span class="var type1" id="S15T4U58">B</span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,11" id="srcline11">11</a></span><span class="line"><span class="comment">% ---------- Values---------</span></span></span>
<span class="srcline"><span class="lineno"><a href="188,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U38"><span class="var type1" id="S18T2U62">a0</span> = <span class="mxinfo " id="T2:U40"><span class="mxinfo " id="T2:U41">-<span class="mxinfo " id="T2:U42">1</span></span>+ <span class="mxinfo " id="T2:U43"><span class="var type1" id="S11T2U67">w12</span>*<span class="var type1" id="S10T2U68">Ts</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T2:U46"><span class="var type1" id="S19T2U71">b0</span> = <span class="mxinfo " id="T2:U48"><span class="mxinfo " id="T2:U49"><span class="mxinfo " id="T2:U50">2</span>*<span class="var type1" id="S11T2U75">w12</span></span>*<span class="var type1" id="S10T2U76">Ts</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T2:U53">[<span class="var type1" id="S20T2U80">n</span>,<span class="mxinfo " id="T2:U55">~</span>] = size(<span class="var type1" id="S13T187U84">A</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T187:U57"><span class="var type1" id="S22T187U87">A_d</span> = <span class="mxinfo " id="T187:U59">(<span class="mxinfo " id="T187:U60"><span class="mxinfo " id="T187:U61">eye(<span class="var type1" id="S20T2U93">n</span>,<span class="var type1" id="S20T2U94">n</span>)</span>+<span class="mxinfo " id="T187:U64"><span class="mxinfo " id="T187:U65"><span class="mxinfo " id="T2:U66">0.5</span>*<span class="var type1" id="S13T187U98">A</span></span>*<span class="var type1" id="S10T2U99">Ts</span></span></span>)*<span class="mxinfo " id="T187:U69">inv(<span class="mxinfo " id="T187:U70"><span class="mxinfo " id="T187:U71">eye(<span class="var type1" id="S20T2U105">n</span>,<span class="var type1" id="S20T2U106">n</span>)</span>-<span class="mxinfo " id="T187:U74"><span class="mxinfo " id="T187:U75"><span class="mxinfo " id="T2:U76">0.5</span>*<span class="var type1" id="S13T187U110">A</span></span>*<span class="var type1" id="S10T2U111">Ts</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T4:U79"><span class="var type1" id="S25T4U114">B_d</span> = <span class="mxinfo " id="T4:U81"><span class="var type1" id="S10T2U116">Ts</span>*<span class="var type1" id="S15T4U117">B</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T2:U84"><span class="var type1" id="S26T2U120">u1</span> = <span class="mxinfo " id="T2:U86"><span class="var type1" id="S4T6U122">u_mC</span>(<span class="mxinfo " id="T2:U88">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U89"><span class="var type1" id="S27T2U126">u2</span> = <span class="mxinfo " id="T2:U91"><span class="var type1" id="S4T6U128">u_mC</span>(<span class="mxinfo " id="T2:U93">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T2:U94"><span class="mxinfo " id="T2:U95"><span class="var type1" id="S2T67U133">dx</span>(<span class="mxinfo " id="T2:U97">1</span>)</span> = <span class="mxinfo " id="T2:U98"><span class="mxinfo " id="T2:U99"><span class="mxinfo " id="T2:U100"><span class="mxinfo " id="T2:U101">-<span class="var type1" id="S18T2U139">a0</span></span>*<span class="mxinfo " id="T2:U103"><span class="var type1" id="S3T67U141">x</span>(<span class="mxinfo " id="T2:U105">1</span>)</span></span>-<span class="mxinfo " id="T2:U106"><span class="mxinfo " id="T2:U107"><span class="mxinfo " id="T2:U108">sum(<span class="mxinfo " id="T4:U109"><span class="var type1" id="S3T67U148">x</span>(<span class="mxinfo " id="T188:U111">3:3+<span class="var type1" id="S20T2U154">n</span>-1</span>)</span>)</span>*<span class="mxinfo " id="T2:U113"><span class="var type1" id="S3T67U157">x</span>(<span class="mxinfo " id="T2:U115">2</span>)</span></span>*<span class="var type1" id="S10T2U159">Ts</span></span></span> + <span class="mxinfo " id="T2:U117"><span class="var type1" id="S19T2U161">b0</span> * <span class="var type1" id="S26T2U162">u1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T2:U120"><span class="mxinfo " id="T2:U121"><span class="var type1" id="S2T67U166">dx</span>(<span class="mxinfo " id="T2:U123">2</span>)</span> = <span class="mxinfo " id="T2:U124"><span class="mxinfo " id="T2:U125"><span class="mxinfo " id="T2:U126"><span class="mxinfo " id="T2:U127"><span class="mxinfo " id="T2:U128">sum(<span class="mxinfo " id="T4:U129"><span class="var type1" id="S3T67U175">x</span>(<span class="mxinfo " id="T188:U131">3:3+<span class="var type1" id="S20T2U181">n</span>-1</span>)</span>)</span> * <span class="mxinfo " id="T2:U133"><span class="var type1" id="S3T67U184">x</span>(<span class="mxinfo " id="T2:U135">1</span>)</span></span> * <span class="var type1" id="S10T2U186">Ts</span></span> - <span class="mxinfo " id="T2:U137"><span class="var type1" id="S18T2U188">a0</span>*<span class="mxinfo " id="T2:U139"><span class="var type1" id="S3T67U190">x</span>(<span class="mxinfo " id="T2:U141">2</span>)</span></span></span> +<span class="mxinfo " id="T2:U142"><span class="var type1" id="S19T2U193">b0</span>* <span class="var type1" id="S27T2U194">u2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T192:U145"><span class="mxinfo " id="T192:U146"><span class="var type1" id="S2T67U198">dx</span>(<span class="mxinfo " id="T192:U148"><span class="mxinfo " id="T2:U149">3</span>:<span class="mxinfo " id="T2:U150">3+<span class="var type1" id="S20T2U204">n</span>-1</span></span>)</span> = <span class="mxinfo " id="T4:U152"><span class="mxinfo " id="T4:U153"><span class="var type1" id="S22T187U208">A_d</span> * <span class="mxinfo " id="T4:U155"><span class="var type1" id="S3T67U210">x</span>(<span class="mxinfo " id="T188:U157">3:3+<span class="var type1" id="S20T2U216">n</span>-1</span>)</span></span> + <span class="mxinfo " id="T4:U159"><span class="var type1" id="S25T4U219">B_d</span> * (<span class="mxinfo " id="T2:U161"><span class="mxinfo " id="T2:U162"><span class="mxinfo " id="T2:U163"><span class="var type1" id="S3T67U224">x</span>(<span class="mxinfo " id="T19:U165">1</span>)</span>.^2</span>+<span class="mxinfo " id="T2:U166"><span class="mxinfo " id="T2:U167"><span class="var type1" id="S3T67U229">x</span>(<span class="mxinfo " id="T19:U169">2</span>)</span>.^2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="188,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="188,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
