<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="208,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">r_2</span> ] = f_compute_parity_Res2_full( <span class="var type1" id="S3T21U6">u_mC</span>, <span class="var type1" id="S4T21U7">y_mC</span>, <span class="var type1" id="S5T4U8">tau_m</span>, <span class="var type1" id="S6T4U9">K_m</span>, <span class="var type1" id="S7T2U10">QL</span>, <span class="var type1" id="S8T2U11">fs</span>,<span class="var type1" id="S9T2U12">f0</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="208,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%UNTITLED8 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%% Define System Matrix of linear detuning model</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T2:U9"><span class="var type1" id="S10T2U15">Ts</span> = <span class="mxinfo " id="T2:U11"><span class="mxinfo " id="T2:U12">1</span>/<span class="var type1" id="S8T2U18">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T2:U14"><span class="var type1" id="S11T2U21">w12</span> = <span class="mxinfo " id="T2:U16"><span class="mxinfo " id="T2:U17"><span class="mxinfo " id="T2:U18">pi</span>*<span class="var type1" id="S9T2U26">f0</span></span>./<span class="var type1" id="S7T2U27">QL</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T194:U21"><span class="var type1" id="S13T194U30">A_c</span> = <span class="mxinfo " id="T194:U23">diag(<span class="mxinfo " id="T4:U24">-1./<span class="var type1" id="S5T4U36">tau_m</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T4:U26"><span class="var type1" id="S15T4U39">B_c</span> = <span class="mxinfo " id="T4:U28"><span class="mxinfo " id="T4:U29"><span class="mxinfo " id="T2:U30">-2*pi</span>*<span class="var type1" id="S6T4U47">K_m</span></span>./<span class="var type1" id="S5T4U48">tau_m</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T2:U33">[<span class="var type1" id="S16T2U52">n</span>,<span class="mxinfo " id="T2:U35">~</span>] = size(<span class="var type1" id="S13T194U56">A_c</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T197:U37"><span class="var type1" id="S18T197U59">C_c</span> = <span class="mxinfo " id="T197:U39">ones(<span class="mxinfo " id="T2:U40">1</span>,<span class="var type1" id="S16T2U63">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U42"><span class="var type1" id="S20T2U66">D_c</span> = <span class="mxinfo " id="T2:U44">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,13" id="srcline13">13</a></span><span class="line"><span class="comment">%--------------- Sample the System Matrix (Euler Forward)------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T194:U45"><span class="var type1" id="S21T194U70">A_d</span> = <span class="mxinfo " id="T194:U47">(<span class="mxinfo " id="T194:U48"><span class="mxinfo " id="T194:U49">eye(<span class="var type1" id="S16T2U76">n</span>,<span class="var type1" id="S16T2U77">n</span>)</span>+<span class="mxinfo " id="T194:U52"><span class="mxinfo " id="T194:U53"><span class="mxinfo " id="T2:U54">0.5</span>*<span class="var type1" id="S13T194U81">A_c</span></span>*<span class="var type1" id="S10T2U82">Ts</span></span></span>)*<span class="mxinfo " id="T194:U57">inv(<span class="mxinfo " id="T194:U58"><span class="mxinfo " id="T194:U59">eye(<span class="var type1" id="S16T2U88">n</span>,<span class="var type1" id="S16T2U89">n</span>)</span>-<span class="mxinfo " id="T194:U62"><span class="mxinfo " id="T194:U63"><span class="mxinfo " id="T2:U64">0.5</span>*<span class="var type1" id="S13T194U93">A_c</span></span>*<span class="var type1" id="S10T2U94">Ts</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T4:U67"><span class="var type1" id="S24T4U97">B_d</span> = <span class="mxinfo " id="T4:U69"><span class="var type1" id="S10T2U99">Ts</span>*<span class="var type1" id="S15T4U100">B_c</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,16" id="srcline16">16</a></span><span class="line"><span class="comment">%------------Compute Parity Space Vector needed for 2nd Residual-----------</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T2:U72"><span class="var type1" id="S25T2U103">D</span> = <span class="var type1" id="S20T2U104">D_c</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T234:U75"><span class="var type1" id="S26T234U107">Hu</span> = <span class="mxinfo " id="T234:U77">[<span class="mxinfo " id="T235:U78"><span class="var type1" id="S25T2U110">D</span>, 0, 0, 0, 0</span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T235:U80"><span class="mxinfo " id="T2:U81"><span class="var type1" id="S18T197U117">C_c</span> * <span class="var type1" id="S24T4U118">B_d</span></span>, <span class="var type1" id="S25T2U119">D</span>, <span class="mxinfo " id="T2:U85">0</span>, <span class="mxinfo " id="T2:U86">0</span>, <span class="mxinfo " id="T2:U87">0</span></span>;<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T235:U88"><span class="mxinfo " id="T2:U89"><span class="mxinfo " id="T197:U90"><span class="var type1" id="S18T197U126">C_c</span> * <span class="var type1" id="S21T194U127">A_d</span></span>* <span class="var type1" id="S24T4U128">B_d</span></span>, <span class="mxinfo " id="T2:U94"><span class="var type1" id="S18T197U130">C_c</span> * <span class="var type1" id="S24T4U131">B_d</span></span>, <span class="var type1" id="S25T2U132">D</span>, <span class="mxinfo " id="T2:U98">0</span>, <span class="mxinfo " id="T2:U99">0</span></span>;<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo " id="T235:U100"><span class="mxinfo " id="T2:U101"><span class="mxinfo " id="T197:U102"><span class="var type1" id="S18T197U138">C_c</span> * <span class="mxinfo " id="T194:U104"><span class="var type1" id="S21T194U140">A_d</span>.^2</span></span> * <span class="var type1" id="S24T4U142">B_d</span></span>, <span class="mxinfo " id="T2:U107"><span class="mxinfo " id="T197:U108"><span class="var type1" id="S18T197U145">C_c</span> * <span class="var type1" id="S21T194U146">A_d</span></span>* <span class="var type1" id="S24T4U147">B_d</span></span>, <span class="mxinfo " id="T2:U112"><span class="var type1" id="S18T197U149">C_c</span> * <span class="var type1" id="S24T4U150">B_d</span></span>, <span class="var type1" id="S25T2U151">D</span>, <span class="mxinfo " id="T2:U116">0</span></span>;<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T235:U117"><span class="mxinfo " id="T2:U118"><span class="mxinfo " id="T197:U119"><span class="var type1" id="S18T197U156">C_c</span> * <span class="mxinfo " id="T194:U121"><span class="var type1" id="S21T194U158">A_d</span>.^3</span></span> * <span class="var type1" id="S24T4U160">B_d</span></span>, <span class="mxinfo " id="T2:U124"><span class="mxinfo " id="T197:U125"><span class="var type1" id="S18T197U163">C_c</span> * <span class="mxinfo " id="T194:U127"><span class="var type1" id="S21T194U165">A_d</span>.^2</span></span> * <span class="var type1" id="S24T4U167">B_d</span></span>, <span class="mxinfo " id="T2:U130"><span class="mxinfo " id="T197:U131"><span class="var type1" id="S18T197U170">C_c</span> * <span class="var type1" id="S21T194U171">A_d</span></span>* <span class="var type1" id="S24T4U172">B_d</span></span>, <span class="mxinfo " id="T2:U135"><span class="var type1" id="S18T197U174">C_c</span> * <span class="var type1" id="S24T4U175">B_d</span></span>, <span class="var type1" id="S25T2U176">D</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T240:U139"><span class="var type1" id="S27T240U179">Ho</span> = <span class="mxinfo " id="T240:U141">[<span class="var type1" id="S18T197U182">C_c</span>; <span class="mxinfo " id="T197:U143"><span class="var type1" id="S18T197U185">C_c</span> * <span class="var type1" id="S21T194U186">A_d</span></span>; <span class="mxinfo " id="T197:U146"><span class="var type1" id="S18T197U189">C_c</span> * <span class="mxinfo " id="T194:U148"><span class="var type1" id="S21T194U191">A_d</span>.^2</span></span>; <span class="mxinfo " id="T197:U150"><span class="var type1" id="S18T197U195">C_c</span> * <span class="mxinfo " id="T194:U152"><span class="var type1" id="S21T194U197">A_d</span>.^3</span></span>; <span class="mxinfo " id="T197:U154"><span class="var type1" id="S18T197U201">C_c</span> * <span class="mxinfo " id="T194:U156"><span class="var type1" id="S21T194U203">A_d</span>.^4</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T241:U158"><span class="var type1" id="S28T241U207">v</span> = <span class="mxinfo " id="T241:U160"><span class="mxinfo " id="T236:U161">null(<span class="mxinfo " id="T233:U162"><span class="var type1" id="S27T240U212">Ho</span>'</span>)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T235:U164"><span class="var type1" id="S30T235U215">v_prod</span> = <span class="mxinfo " id="T235:U166"><span class="mxinfo " id="T235:U167"><span class="var type1" id="S28T241U218">v</span>(<span class="mxinfo " id="T2:U169">1</span>,<span class="mxinfo " id="T237:U170">:</span>)</span>*<span class="var type1" id="S26T234U221">Hu</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,26" id="srcline26">26</a></span><span class="line"><span class="comment">%%-------------- input and states of the system---------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T1:U172"><span class="var type1" id="S31T1U224">u1</span> = <span class="mxinfo " id="T1:U174">real(<span class="var type1" id="S3T21U227">u_mC</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T1:U176"><span class="var type1" id="S33T1U230">u2</span> = <span class="mxinfo " id="T1:U178">imag(<span class="var type1" id="S3T21U233">u_mC</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T1:U180"><span class="var type1" id="S35T1U236">x1</span> = <span class="mxinfo " id="T1:U182">real(<span class="var type1" id="S4T21U239">y_mC</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T1:U184"><span class="var type1" id="S36T1U242">x2</span> = <span class="mxinfo " id="T1:U186">imag(<span class="var type1" id="S4T21U245">y_mC</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,31" id="srcline31">31</a></span><span class="line"><span class="comment">%r_2 = zeros(length(u1),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T1:U188"><span class="var type1" id="S37T1U248">x_d1</span> = <span class="mxinfo " id="T1:U190"><span class="mxinfo " id="T1:U191">-<span class="mxinfo " id="T1:U192"><span class="var type1" id="S35T1U253">x1</span>(<span class="mxinfo " id="T9:U194"><span class="mxinfo " id="T2:U195">2</span>:end</span>,<span class="mxinfo " id="T18:U196">:</span>)</span> + <span class="mxinfo " id="T1:U197"><span class="var type1" id="S35T1U260">x1</span>(<span class="mxinfo " id="T9:U199"><span class="mxinfo " id="T2:U200">1</span>:<span class="mxinfo " id="T2:U201"><span class="mxinfo " id="T2:U202">end</span>-<span class="mxinfo " id="T2:U203">1</span></span></span>,<span class="mxinfo " id="T18:U204">:</span>)</span></span> + (<span class="mxinfo " id="T1:U205"><span class="mxinfo " id="T1:U206"><span class="mxinfo " id="T2:U207">-<span class="var type1" id="S10T2U272">Ts</span></span> * <span class="mxinfo " id="T1:U209"><span class="var type1" id="S35T1U274">x1</span>(<span class="mxinfo " id="T9:U211"><span class="mxinfo " id="T2:U212">1</span>:<span class="mxinfo " id="T2:U213"><span class="mxinfo " id="T2:U214">end</span>-<span class="mxinfo " id="T2:U215">1</span></span></span>,<span class="mxinfo " id="T18:U216">:</span>)</span></span> + <span class="mxinfo " id="T1:U217"><span class="mxinfo " id="T1:U218"><span class="mxinfo " id="T2:U219"><span class="mxinfo " id="T2:U220">2</span> * <span class="var type1" id="S10T2U286">Ts</span></span> * <span class="mxinfo " id="T1:U222"><span class="var type1" id="S31T1U288">u1</span>(<span class="mxinfo " id="T9:U224"><span class="mxinfo " id="T2:U225">1</span>:<span class="mxinfo " id="T2:U226"><span class="mxinfo " id="T2:U227">end</span>-<span class="mxinfo " id="T2:U228">1</span></span></span>,<span class="mxinfo " id="T18:U229">:</span>)</span></span> .* <span class="var type1" id="S11T2U296">w12</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,33" id="srcline33">33</a></span><span class="line"><span class="comment">% -------------------second residual-----------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T1:U231"><span class="var type1" id="S39T1U299">u_dw</span> = <span class="mxinfo " id="T1:U233"><span class="mxinfo " id="T1:U234"><span class="var type1" id="S35T1U302">x1</span>.^2</span> + <span class="mxinfo " id="T1:U236"><span class="var type1" id="S36T1U305">x2</span>.^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T1:U238"><span class="var type1" id="S40T1U309">u_dw_stacked1</span> =<span class="mxinfo " id="T1:U240"><span class="var type1" id="S39T1U311">u_dw</span>.*(<span class="mxinfo " id="T1:U242"><span class="var type1" id="S10T2U314">Ts</span> * <span class="var type1" id="S36T1U315">x2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T1:U245"><span class="var type1" id="S41T1U318">conv1</span> = <span class="mxinfo " id="T1:U247">conv(<span class="var type1" id="S37T1U321">x_d1</span>, <span class="mxinfo " id="T170:U249"><span class="mxinfo " id="T235:U250"><span class="var type1" id="S28T241U324">v</span>(<span class="mxinfo " id="T2:U252">1</span>,<span class="mxinfo " id="T237:U253">:</span>)</span>.'</span>,<span class="string">'valid'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T1:U254"><span class="var type1" id="S43T1U330">convo2</span> = <span class="mxinfo " id="T1:U256">conv(<span class="mxinfo " id="T1:U257"><span class="var type1" id="S40T1U334">u_dw_stacked1</span>(<span class="mxinfo " id="T9:U259"><span class="mxinfo " id="T2:U260">2</span>:end</span>)</span>, <span class="mxinfo " id="T170:U261"><span class="var type1" id="S30T235U340">v_prod</span>.'</span>, <span class="string">'valid'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T1:U263"><span class="var type1" id="S44T1U344">conv3</span> = <span class="mxinfo " id="T1:U265"><span class="var type1" id="S41T1U346">conv1</span> - <span class="var type1" id="S43T1U347">convo2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T1:U268"><span class="var type1" id="S2T1U350">r_2</span> = <span class="var type1" id="S44T1U351">conv3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="208,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="208,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="208,42" id="srcline42">42</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="208,43" id="srcline43">43</a></span><span class="line"></span></span>
</pre>
</body>
</html>
